# ── Keycloak HTTPS on port 8443 ───────────────────────────────────────────────
#
# Proxies to Keycloak HTTP on port 8180 (inside Docker network).
# KC_PROXY_HEADERS=xforwarded ensures Keycloak builds correct redirect URLs
# and self-links using the HTTPS address the client actually connected to.
# ─────────────────────────────────────────────────────────────────────────────
server {
    listen      8443 ssl;
    server_name localhost;

    # Increase buffer sizes for Keycloak's large redirect responses
    proxy_buffer_size        128k;
    proxy_buffers            4 256k;
    proxy_busy_buffers_size  256k;

    location / {
        proxy_pass         http://keycloak:8180;

        proxy_set_header   Host              $host;
        proxy_set_header   X-Real-IP         $remote_addr;
        proxy_set_header   X-Forwarded-For   $proxy_add_x_forwarded_for;
        proxy_set_header   X-Forwarded-Proto https;
        proxy_set_header   X-Forwarded-Port  8443;

        proxy_read_timeout 90s;
    }
}

